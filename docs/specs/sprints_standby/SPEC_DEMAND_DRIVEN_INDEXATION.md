# SpÃ©cification : Demand-Driven Indexation

**Date**: 2026-01-06
**Version**: 1.0
**Statut**: Draft
**Auteur**: Thomas

---

## 1. Vision

### 1.1 ProblÃ¨me

Les moteurs de recherche textiles traditionnels ont deux approches :
- **Indexation complÃ¨te** : Scraper tout, tout le temps â†’ coÃ»teux, donnÃ©es pÃ©rimÃ©es
- **Indexation manuelle** : Admin dÃ©cide quoi scraper â†’ pas rÃ©actif aux besoins

### 1.2 Solution : Demand-Driven

Les recherches utilisateurs **alimentent** le pipeline d'indexation :
- Recherche sans rÃ©sultat â†’ option "Recherche approfondie"
- SystÃ¨me analyse la requÃªte â†’ scraping ciblÃ© automatique
- Termes inconnus â†’ alerte admin pour enrichir le dictionnaire

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚    UTILISATEUR           SYSTÃˆME              ADMIN                         â”‚
â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€                         â”‚
â”‚                                                                             â”‚
â”‚    Recherche        â†’    Pas assez de    â†’   (rien Ã  faire               â”‚
â”‚    "soie bleue"          rÃ©sultats           si termes connus)             â”‚
â”‚         â”‚                    â”‚                                              â”‚
â”‚         â–¼                    â–¼                                              â”‚
â”‚    "Recherche        â†’   Parse requÃªte                                      â”‚
â”‚    approfondie"          - soie = silk âœ“                                   â”‚
â”‚         â”‚                - bleue = blue âœ“                                  â”‚
â”‚         â”‚                    â”‚                                              â”‚
â”‚         â”‚                    â–¼                                              â”‚
â”‚         â”‚              Scraping ciblÃ©   â†’   Notification                   â”‚
â”‚         â”‚              TFS + MLC            si problÃ¨me                     â”‚
â”‚         â”‚                    â”‚                                              â”‚
â”‚         â–¼                    â–¼                                              â”‚
â”‚    Notification      â†  Nouveaux                                           â”‚
â”‚    "12 rÃ©sultats"       rÃ©sultats                                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚    UTILISATEUR           SYSTÃˆME              ADMIN                         â”‚
â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€                         â”‚
â”‚                                                                             â”‚
â”‚    Recherche        â†’    Pas assez de                                       â”‚
â”‚    "lin bio certifiÃ©"    rÃ©sultats                                         â”‚
â”‚         â”‚                    â”‚                                              â”‚
â”‚         â–¼                    â–¼                                              â”‚
â”‚    "Recherche        â†’   Parse requÃªte                                      â”‚
â”‚    approfondie"          - lin = linen âœ“                                   â”‚
â”‚         â”‚                - bio certifiÃ© = â“                               â”‚
â”‚         â”‚                    â”‚                                              â”‚
â”‚         â”‚                    â–¼                                              â”‚
â”‚         â”‚              Log demande      â†’   Alerte                         â”‚
â”‚         â”‚              + suggestion LLM     "Terme inconnu"                â”‚
â”‚         â”‚                    â”‚                   â”‚                          â”‚
â”‚         â–¼                    â”‚                   â–¼                          â”‚
â”‚    "Nous cherchons,         â”‚              Review + approve                â”‚
â”‚    vous serez notifiÃ©"      â”‚              "organic certified"             â”‚
â”‚         â”‚                    â”‚                   â”‚                          â”‚
â”‚         â”‚                    â–¼                   â”‚                          â”‚
â”‚         â”‚              Scraping auto     â†â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚         â”‚                    â”‚                                              â”‚
â”‚         â–¼                    â–¼                                              â”‚
â”‚    Notification      â†  Nouveaux                                           â”‚
â”‚    "8 rÃ©sultats"        rÃ©sultats                                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 BÃ©nÃ©fices

| Aspect | Avant | AprÃ¨s Demand-Driven |
|--------|-------|---------------------|
| Scraping | PlanifiÃ© aveugle | CiblÃ© selon besoins |
| CoÃ»ts API | Ã‰levÃ©s (tout scraper) | OptimisÃ©s |
| FraÃ®cheur | Variable | FraÃ®che pour demandes |
| Dictionnaire | Enrichi manuellement | Enrichi par usage |
| UX | "Pas de rÃ©sultat" | "On cherche pour vous" |

---

## 2. Flux Utilisateur

### 2.1 Parcours Recherche Standard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     INTERFACE RECHERCHE                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ğŸ” Recherche : [soie bleue marine_________________________] [Rechercher]   â”‚
â”‚                                                                             â”‚
â”‚  Filtres: [MatiÃ¨re â–¼] [Couleur â–¼] [Prix â–¼] [Disponible âœ“]                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â–¼                               â–¼
            RÃ©sultats suffisants            RÃ©sultats insuffisants
            (â‰¥ 10 produits)                 (< 10 produits)
                      â”‚                               â”‚
                      â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… 47 rÃ©sultats            â”‚     â”‚  ğŸ˜• Seulement 3 rÃ©sultats               â”‚
â”‚                             â”‚     â”‚                                         â”‚
â”‚  [Affichage normal]         â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚                             â”‚     â”‚  â”‚ ğŸ” Recherche approfondie            â”‚â”‚
â”‚                             â”‚     â”‚  â”‚                                     â”‚â”‚
â”‚                             â”‚     â”‚  â”‚ Nous pouvons lancer une recherche   â”‚â”‚
â”‚                             â”‚     â”‚  â”‚ en temps rÃ©el sur nos sources.      â”‚â”‚
â”‚                             â”‚     â”‚  â”‚                                     â”‚â”‚
â”‚                             â”‚     â”‚  â”‚ â±ï¸ Temps estimÃ© : 2-5 minutes       â”‚â”‚
â”‚                             â”‚     â”‚  â”‚                                     â”‚â”‚
â”‚                             â”‚     â”‚  â”‚ [ğŸ” Lancer la recherche]            â”‚â”‚
â”‚                             â”‚     â”‚  â”‚ [ğŸ“§ Me notifier par email]          â”‚â”‚
â”‚                             â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                             â”‚     â”‚                                         â”‚
â”‚                             â”‚     â”‚  En attendant, voici les 3 rÃ©sultats : â”‚
â”‚                             â”‚     â”‚  [Affichage rÃ©sultats existants]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Parcours Recherche Approfondie

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ã‰TAPE 1 : Utilisateur clique "Lancer la recherche"                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ” Recherche approfondie en cours...                                 â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  35%                       â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚  âœ“ The Fabric Sales : 12 nouveaux rÃ©sultats                          â”‚ â”‚
â”‚  â”‚  â³ My Little Coupon : en cours...                                    â”‚ â”‚
â”‚  â”‚  â—‹ Recovo : en attente                                                â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚  [Annuler]                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ã‰TAPE 2 : Recherche terminÃ©e                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  âœ… Recherche approfondie terminÃ©e !                                  â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚  ğŸ‰ 23 nouveaux rÃ©sultats trouvÃ©s                                     â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚  â€¢ The Fabric Sales : +12 produits                                    â”‚ â”‚
â”‚  â”‚  â€¢ My Little Coupon : +8 produits                                     â”‚ â”‚
â”‚  â”‚  â€¢ Recovo : +3 produits                                               â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚  [Voir les rÃ©sultats]                                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 Parcours Notification Email

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EMAIL ENVOYÃ‰ Ã€ L'UTILISATEUR                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Objet : ğŸ‰ Nous avons trouvÃ© votre tissu "soie bleue marine"              â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                                             â”‚
â”‚  Bonjour,                                                                   â”‚
â”‚                                                                             â”‚
â”‚  Suite Ã  votre recherche "soie bleue marine", nous avons trouvÃ©             â”‚
â”‚  23 nouveaux rÃ©sultats qui pourraient vous intÃ©resser.                      â”‚
â”‚                                                                             â”‚
â”‚  [Voir les 23 rÃ©sultats â†’]                                                  â”‚
â”‚                                                                             â”‚
â”‚  AperÃ§u :                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚  â”‚  [IMG]  â”‚ â”‚  [IMG]  â”‚ â”‚  [IMG]  â”‚                                       â”‚
â”‚  â”‚ Soie    â”‚ â”‚ Soie    â”‚ â”‚ Soie    â”‚                                       â”‚
â”‚  â”‚ marine  â”‚ â”‚ bleu    â”‚ â”‚ navy    â”‚                                       â”‚
â”‚  â”‚ 12â‚¬/m   â”‚ â”‚ 15â‚¬/m   â”‚ â”‚ 18â‚¬/m   â”‚                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚                                                                             â”‚
â”‚  Ã€ bientÃ´t sur Deadstock !                                                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Flux SystÃ¨me

### 3.1 Parsing de la RequÃªte

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PARSING REQUÃŠTE UTILISATEUR                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Input : "soie bleue marine 3m minimum"                                     â”‚
â”‚                                                                             â”‚
â”‚  Ã‰TAPE 1 : Tokenisation                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ["soie", "bleue", "marine", "3m", "minimum"]                              â”‚
â”‚                                                                             â”‚
â”‚  Ã‰TAPE 2 : Lookup Dictionnaire (par source_locale de l'user ou 'fr')       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  "soie" â†’ fiber:silk âœ“                                                      â”‚
â”‚  "bleue" â†’ color:blue âœ“                                                     â”‚
â”‚  "marine" â†’ (modificateur couleur, ignorÃ© ou combinÃ©)                      â”‚
â”‚  "3m" â†’ length:3 (pattern (\d+)m) âœ“                                        â”‚
â”‚  "minimum" â†’ (stopword, ignorÃ©)                                            â”‚
â”‚                                                                             â”‚
â”‚  Ã‰TAPE 3 : Construction CritÃ¨res NormalisÃ©s                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  {                                                                          â”‚
â”‚    fiber: "silk",                                                           â”‚
â”‚    color: "navy blue",        // Combinaison blue + marine                 â”‚
â”‚    min_length: 3,                                                           â”‚
â”‚    unknown_terms: []          // Tout reconnu âœ“                            â”‚
â”‚  }                                                                          â”‚
â”‚                                                                             â”‚
â”‚  Ã‰TAPE 4 : Identification Sites Pertinents                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ The Fabric Sales : a "silk" dans collections â†’ âœ“                        â”‚
â”‚  â€¢ My Little Coupon : a "soie" (equiv silk) â†’ âœ“                           â”‚
â”‚  â€¢ Recovo : pas de soie dÃ©tectÃ©e â†’ âœ—                                       â”‚
â”‚                                                                             â”‚
â”‚  Output : {                                                                 â”‚
â”‚    parsed_criteria: { fiber: "silk", color: "navy blue", min_length: 3 },  â”‚
â”‚    unknown_terms: [],                                                       â”‚
â”‚    target_sites: ["tfs_id", "mlc_id"],                                     â”‚
â”‚    can_auto_scrape: true                                                   â”‚
â”‚  }                                                                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Cas avec Terme Inconnu

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PARSING AVEC TERME INCONNU                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Input : "lin bio certifiÃ© GOTS"                                           â”‚
â”‚                                                                             â”‚
â”‚  Lookup Dictionnaire :                                                      â”‚
â”‚  "lin" â†’ fiber:linen âœ“                                                      â”‚
â”‚  "bio" â†’ â“ pas trouvÃ©                                                      â”‚
â”‚  "certifiÃ©" â†’ â“ pas trouvÃ©                                                 â”‚
â”‚  "GOTS" â†’ â“ pas trouvÃ©                                                     â”‚
â”‚                                                                             â”‚
â”‚  Output : {                                                                 â”‚
â”‚    parsed_criteria: { fiber: "linen" },                                    â”‚
â”‚    unknown_terms: ["bio", "certifiÃ©", "GOTS"],                             â”‚
â”‚    target_sites: ["tfs_id", "mlc_id"],                                     â”‚
â”‚    can_auto_scrape: false,  // Termes inconnus bloquent                    â”‚
â”‚    suggestion: "Termes inconnus dÃ©tectÃ©s, en attente review admin"        â”‚
â”‚  }                                                                          â”‚
â”‚                                                                             â”‚
â”‚  ACTION SYSTÃˆME :                                                           â”‚
â”‚  1. CrÃ©er indexation_request avec status='needs_review'                    â”‚
â”‚  2. Logger les unknown_terms avec contexte                                 â”‚
â”‚  3. (Optionnel) Appeler LLM pour suggestion :                              â”‚
â”‚     - "bio certifiÃ©" â†’ suggestion: "organic certified" (92%)               â”‚
â”‚     - "GOTS" â†’ suggestion: "GOTS" (certification, 98%)                     â”‚
â”‚  4. Notifier admin                                                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 Algorithme de Scraping CiblÃ©

```typescript
async function handleDeepSearchRequest(request: IndexationRequest) {
  // 1. Construire les filtres Shopify Ã  partir des critÃ¨res normalisÃ©s
  const shopifyFilters = buildShopifyFilters(request.parsed_criteria);
  
  // Exemple: { fiber: "silk", color: "navy" }
  // â†’ Shopify tags filter: "silk" AND ("navy" OR "blue")
  
  // 2. Identifier les collections pertinentes par site
  for (const siteId of request.target_sites) {
    const site = await getSite(siteId);
    const rules = await getExtractionRules(siteId);
    
    // Trouver collections qui contiennent probablement le produit
    const relevantCollections = site.collections.filter(c => 
      c.tags_frequency.some(t => matchesCriteria(t, request.parsed_criteria))
    );
    
    // 3. Scraper uniquement ces collections
    for (const collection of relevantCollections) {
      await scrapingService.scrapeCollection(site, collection, {
        sourceLocale: site.source_locale,
        filters: shopifyFilters,
        maxProducts: 50,  // LimitÃ© pour recherche ciblÃ©e
      });
    }
  }
  
  // 4. Compter nouveaux rÃ©sultats matchant la requÃªte
  const newResults = await countNewMatches(request.parsed_criteria);
  
  // 5. Notifier utilisateur
  await notifyUser(request, newResults);
}
```

---

## 4. Flux Admin

### 4.1 Dashboard Demandes d'Indexation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin > Indexation > Demandes                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  ğŸ“Š Vue d'ensemble                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Cette semaineâ”‚ Auto-traitÃ©esâ”‚ En attente   â”‚ Termes apprisâ”‚            â”‚
â”‚  â”‚     47       â”‚     38       â”‚      9       â”‚      12      â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                            â”‚
â”‚  [Toutes] [En attente] [TraitÃ©es] [Ã‰chec]                                  â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  âš ï¸ NÃ‰CESSITE REVIEW (9)                                            â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ "lin bio certifiÃ© GOTS"                        7 demandes       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ Termes reconnus : lin â†’ linen âœ“                                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ Termes inconnus :                                               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚   â€¢ "bio" â†’ ğŸ’¡ Suggestion LLM: "organic" (92%)                  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚            [Approuver "organic"] [Autre: ____] [Ignorer]        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚   â€¢ "certifiÃ©" â†’ ğŸ’¡ Suggestion: "certified" (95%)               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚            [Approuver "certified"] [Autre: ____] [Ignorer]      â”‚ â”‚  â”‚
â”‚  â”‚  â”‚   â€¢ "GOTS" â†’ ğŸ’¡ Suggestion: "GOTS" (certification) (98%)        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚            [Approuver] [CatÃ©gorie: certification â–¼] [Ignorer]   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                                  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ Sites ciblÃ©s : TFS, MLC                                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ Utilisateurs en attente : 7                                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                                  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ [âœ“ Approuver tout + Lancer scraping]  [Voir dÃ©tails]           â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ "tissu technique respirant"                    4 demandes       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ Termes inconnus :                                               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚   â€¢ "technique" â†’ ğŸ’¡ Suggestion: "technical" (88%)              â”‚ â”‚  â”‚
â”‚  â”‚  â”‚   â€¢ "respirant" â†’ ğŸ’¡ Suggestion: "breathable" (91%)             â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                                  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ [âœ“ Approuver tout + Lancer scraping]  [Voir dÃ©tails]           â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  âœ… AUTO-TRAITÃ‰ES RÃ‰CEMMENT (38)                                    â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  â€¢ "soie bleue marine" - 5 demandes - 23 rÃ©sultats - il y a 2h     â”‚  â”‚
â”‚  â”‚  â€¢ "coton rayÃ© rouge" - 3 demandes - 12 rÃ©sultats - il y a 4h      â”‚  â”‚
â”‚  â”‚  â€¢ "velours vert" - 2 demandes - 8 rÃ©sultats - il y a 6h           â”‚  â”‚
â”‚  â”‚  ...                                                                 â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  [Voir tout]                                                         â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ“ˆ INSIGHTS                                                        â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  Top recherches non satisfaites cette semaine :                      â”‚  â”‚
â”‚  â”‚  1. "bio" / "organic" - 15 demandes (terme Ã  ajouter)               â”‚  â”‚
â”‚  â”‚  2. "technique" / "technical" - 8 demandes                          â”‚  â”‚
â”‚  â”‚  3. "recyclÃ©" / "recycled" - 6 demandes                             â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  ğŸ’¡ Suggestion : Ajouter ces 3 termes au dictionnaire               â”‚  â”‚
â”‚  â”‚                  pourrait dÃ©bloquer 29 demandes                      â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  [Ajouter les 3 termes]                                              â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Configuration Auto-Scraping

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin > Indexation > Configuration                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ¤– AUTO-SCRAPING (Demand-Driven)                                    â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  [âœ“ ActivÃ©]  Scraper automatiquement si tous les termes sont connus â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  Seuils :                                                            â”‚  â”‚
â”‚  â”‚  â€¢ DÃ©lai minimum entre 2 scrapings mÃªme critÃ¨res : [30 min â–¼]       â”‚  â”‚
â”‚  â”‚  â€¢ Nombre max de produits par scraping ciblÃ© : [50 â–¼]               â”‚  â”‚
â”‚  â”‚  â€¢ Nombre max de demandes traitÃ©es par heure : [10 â–¼]               â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ”” NOTIFICATIONS ADMIN                                              â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  [âœ“] Notifier si terme inconnu frÃ©quent (> 5 demandes)              â”‚  â”‚
â”‚  â”‚  [âœ“] Notifier si scraping auto Ã©choue                               â”‚  â”‚
â”‚  â”‚  [ ] Rapport quotidien des demandes                                  â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  Email : [thomas@example.com____________________]                    â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ“§ NOTIFICATIONS UTILISATEURS                                       â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  [âœ“] Notifier quand recherche approfondie terminÃ©e                  â”‚  â”‚
â”‚  â”‚  [âœ“] Notifier quand demande en attente est dÃ©bloquÃ©e                â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  DÃ©lai max avant notification "toujours en recherche" : [24h â–¼]     â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                            â”‚
â”‚  [ğŸ’¾ Sauvegarder la configuration]                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. ModÃ¨le de DonnÃ©es

### 5.1 Table : `indexation_requests`

```sql
CREATE TABLE deadstock.indexation_requests (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  
  -- RequÃªte originale
  original_query TEXT NOT NULL,
  user_locale TEXT DEFAULT 'fr',      -- Locale de l'utilisateur
  
  -- Parsing normalisÃ©
  parsed_criteria JSONB,              -- {fiber: "silk", color: "navy", min_length: 3}
  unknown_terms TEXT[],               -- ["bio", "certifiÃ©"] si termes non reconnus
  parsing_confidence NUMERIC,         -- Score de confiance du parsing
  
  -- Sites ciblÃ©s
  target_sites UUID[],                -- Sites pertinents pour cette recherche
  
  -- Statut
  status TEXT DEFAULT 'pending',      
  -- 'pending' : En attente de traitement
  -- 'processing' : Scraping en cours
  -- 'completed' : TerminÃ© avec rÃ©sultats
  -- 'needs_review' : Termes inconnus, attente admin
  -- 'failed' : Ã‰chec scraping
  -- 'expired' : Trop ancien, ignorÃ©
  
  -- AgrÃ©gation (plusieurs users mÃªme requÃªte)
  request_count INTEGER DEFAULT 1,    -- Nombre de demandes similaires
  user_sessions TEXT[],               -- Session IDs des demandeurs
  notify_emails TEXT[],               -- Emails pour notification
  
  -- RÃ©sultat
  scraping_job_id UUID REFERENCES scraping_jobs(id),
  results_count INTEGER,              -- Nombre de rÃ©sultats trouvÃ©s
  results_preview JSONB,              -- [{id, name, image_url}] max 5
  
  -- Timestamps
  first_requested_at TIMESTAMPTZ DEFAULT NOW(),
  last_requested_at TIMESTAMPTZ DEFAULT NOW(),
  processed_at TIMESTAMPTZ,
  notified_at TIMESTAMPTZ,
  
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Index pour agrÃ©gation par critÃ¨res similaires
CREATE INDEX idx_indexation_requests_parsed 
  ON deadstock.indexation_requests 
  USING GIN (parsed_criteria);

-- Index pour statut
CREATE INDEX idx_indexation_requests_status 
  ON deadstock.indexation_requests(status)
  WHERE status IN ('pending', 'needs_review');

-- Index pour nettoyage
CREATE INDEX idx_indexation_requests_created 
  ON deadstock.indexation_requests(created_at);
```

### 5.2 Table : `indexation_config`

```sql
CREATE TABLE deadstock.indexation_config (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  
  -- Auto-scraping
  auto_scrape_enabled BOOLEAN DEFAULT true,
  min_delay_between_scrapes INTEGER DEFAULT 1800,  -- 30 min en secondes
  max_products_per_scrape INTEGER DEFAULT 50,
  max_requests_per_hour INTEGER DEFAULT 10,
  
  -- Notifications admin
  notify_admin_unknown_threshold INTEGER DEFAULT 5,  -- AprÃ¨s N demandes
  notify_admin_on_failure BOOLEAN DEFAULT true,
  admin_email TEXT,
  
  -- Notifications utilisateur
  notify_user_on_complete BOOLEAN DEFAULT true,
  notify_user_on_unblock BOOLEAN DEFAULT true,
  max_wait_before_update INTEGER DEFAULT 86400,  -- 24h en secondes
  
  -- Nettoyage
  expire_requests_after INTEGER DEFAULT 604800,  -- 7 jours en secondes
  
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Une seule ligne de config
INSERT INTO deadstock.indexation_config DEFAULT VALUES;
```

### 5.3 Fonction : AgrÃ©gation des demandes similaires

```sql
CREATE OR REPLACE FUNCTION deadstock.upsert_indexation_request(
  p_original_query TEXT,
  p_parsed_criteria JSONB,
  p_unknown_terms TEXT[],
  p_target_sites UUID[],
  p_user_session TEXT,
  p_notify_email TEXT DEFAULT NULL
)
RETURNS UUID AS $$
DECLARE
  v_existing_id UUID;
  v_result_id UUID;
BEGIN
  -- Chercher une demande existante avec mÃªmes critÃ¨res (non traitÃ©e)
  SELECT id INTO v_existing_id
  FROM deadstock.indexation_requests
  WHERE parsed_criteria = p_parsed_criteria
    AND status IN ('pending', 'needs_review', 'processing')
  LIMIT 1;
  
  IF v_existing_id IS NOT NULL THEN
    -- AgrÃ©gation : incrÃ©menter compteur et ajouter user
    UPDATE deadstock.indexation_requests
    SET 
      request_count = request_count + 1,
      user_sessions = array_append(user_sessions, p_user_session),
      notify_emails = CASE 
        WHEN p_notify_email IS NOT NULL 
        THEN array_append(notify_emails, p_notify_email)
        ELSE notify_emails
      END,
      last_requested_at = NOW(),
      updated_at = NOW()
    WHERE id = v_existing_id
    RETURNING id INTO v_result_id;
  ELSE
    -- Nouvelle demande
    INSERT INTO deadstock.indexation_requests (
      original_query,
      parsed_criteria,
      unknown_terms,
      target_sites,
      status,
      user_sessions,
      notify_emails
    ) VALUES (
      p_original_query,
      p_parsed_criteria,
      p_unknown_terms,
      p_target_sites,
      CASE WHEN array_length(p_unknown_terms, 1) > 0 THEN 'needs_review' ELSE 'pending' END,
      ARRAY[p_user_session],
      CASE WHEN p_notify_email IS NOT NULL THEN ARRAY[p_notify_email] ELSE ARRAY[]::TEXT[] END
    )
    RETURNING id INTO v_result_id;
  END IF;
  
  RETURN v_result_id;
END;
$$ LANGUAGE plpgsql;
```

---

## 6. IntÃ©gration avec le SystÃ¨me Existant

### 6.1 Lien avec Extraction Rules

Les `site_extraction_rules` sont utilisÃ©es pour :
1. **Parser la requÃªte** : Identifier les termes connus
2. **Identifier sites pertinents** : Quels sites ont ces tags ?
3. **Construire filtres Shopify** : Traduire critÃ¨res en tags Shopify

```typescript
// Exemple d'utilisation des rules pour parser
async function parseUserQuery(query: string, userLocale: Locale): Promise<ParsedCriteria> {
  const tokens = tokenize(query);
  const criteria: ParsedCriteria = {};
  const unknowns: string[] = [];
  
  for (const token of tokens) {
    // 1. Chercher dans dictionnaire
    const dictMatch = await dictionaryRepo.lookup(token, userLocale);
    if (dictMatch) {
      criteria[dictMatch.category] = dictMatch.normalized_value;
      continue;
    }
    
    // 2. Chercher dans extraction rules de tous les sites
    const ruleMatch = await extractionRulesRepo.findByTag(token);
    if (ruleMatch) {
      criteria[ruleMatch.category] = token;
      continue;
    }
    
    // 3. Terme inconnu
    if (!isStopword(token)) {
      unknowns.push(token);
    }
  }
  
  return { criteria, unknowns };
}
```

### 6.2 Lien avec Unknown Terms

Quand un terme inconnu est dÃ©tectÃ© dans une demande :
1. Log dans `unknown_terms` avec source = 'user_search'
2. Suggestion LLM si activÃ©
3. Si admin approuve â†’ ajout au dictionnaire
4. Reprocess automatique des demandes en attente

```typescript
// Quand admin approuve un terme
async function onTermApproved(unknownTermId: string, normalizedValue: string) {
  // 1. Ajouter au dictionnaire
  await dictionaryRepo.createMapping({
    source_term: unknownTerm.term,
    source_locale: 'fr',
    translations: { en: normalizedValue },
    category_id: unknownTerm.category,
    source: 'user_search'
  });
  
  // 2. Trouver demandes en attente avec ce terme
  const pendingRequests = await indexationRequestsRepo.findByUnknownTerm(unknownTerm.term);
  
  // 3. Re-parser et dÃ©bloquer
  for (const request of pendingRequests) {
    const newUnknowns = request.unknown_terms.filter(t => t !== unknownTerm.term);
    
    if (newUnknowns.length === 0) {
      // Plus de termes inconnus â†’ lancer scraping
      await triggerAutoScrape(request);
    } else {
      // Mettre Ã  jour la liste des unknowns
      await indexationRequestsRepo.update(request.id, { unknown_terms: newUnknowns });
    }
  }
}
```

---

## 7. Plan d'ImplÃ©mentation

### Phase 1 : Infrastructure (4h)
- [ ] CrÃ©er tables `indexation_requests`, `indexation_config`
- [ ] CrÃ©er fonction `upsert_indexation_request`
- [ ] CrÃ©er `indexationRequestsRepo.ts`

### Phase 2 : Parsing RequÃªte (3h)
- [ ] Service `parseUserQuery()` utilisant dictionnaire
- [ ] IntÃ©gration avec extraction rules
- [ ] Tests unitaires parsing

### Phase 3 : UI Utilisateur (4h)
- [ ] Composant "Recherche approfondie" dans rÃ©sultats
- [ ] Modal de progression
- [ ] Notification email (template + envoi)

### Phase 4 : Auto-Scraping (3h)
- [ ] Service `handleIndexationRequest()`
- [ ] IntÃ©gration avec `scrapingService`
- [ ] Job de traitement des demandes pending

### Phase 5 : UI Admin (4h)
- [ ] Page `/admin/indexation`
- [ ] Dashboard demandes
- [ ] Actions approve/reject
- [ ] Configuration

### Phase 6 : Optimisations (2h)
- [ ] AgrÃ©gation demandes similaires
- [ ] Cache parsing
- [ ] Cleanup vieilles demandes

---

## 8. MÃ©triques de SuccÃ¨s

| MÃ©trique | Cible |
|----------|-------|
| Demandes auto-traitÃ©es | > 80% |
| Temps moyen traitement | < 5 min |
| Taux de rÃ©sultats trouvÃ©s | > 70% |
| Termes appris par semaine | > 10 |
| Satisfaction utilisateur | > 4/5 |

---

**Documents liÃ©s** :
- `SPEC_ADMIN_DATA_TUNING_V3.md` - Spec complÃ¨te admin tuning
- `ADR-020` - Source locale configuration
- `ADR-021` - IntÃ©gration normalisation scraping
